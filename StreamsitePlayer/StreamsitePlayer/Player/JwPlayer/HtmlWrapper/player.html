<!DOCTYPE html>

<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <script type="text/javascript">
            window.onerror = function(msg, file, line){
                window.external.Log("error: " + msg + "\n" + "file: " + file + "\n" + "line: " + line);
            }
        </script>

		<script type="text/javascript" src="jwplayer/jwplayer.js"></script>
        <link rel="stylesheet" type="text/css" href="jwplayer/jwskinchanges.css" />
		<script type="text/javascript">jwplayer.key="--key--";</script>
	</head>

	<body style="background-color: black;">
		<div id="myvideo" tabindex="0">Loading the player...</div>
		<script type="text/javascript">
            jwplayer("myvideo").setup({
                playlist: [
                    {
                        file: "--file--",
                        title: "--title--",
                        "default": true
                    }
                ],
				displaytitle: true,
                displaydescription: false,
                autostart: true
			});
		</script>
		
		<script type="text/javascript">
			var isOnReadyFired = false;
			playerInstance = jwplayer("myvideo");
			playerInstance.on('time', OnPlaylocationChanged);
			playerInstance.on('complete', OnComplete);
			playerInstance.on('fullscreen', OnFullscreenChanged);
			playerInstance.on('mute', OnMuteChange);
			playerInstance.on('volume', OnVolumeChange);
			playerInstance.on('error', OnError);
			playerInstance.on('setupError', OnSetupError);


			function setupNextPrev() {
			    var element = document.getElementsByClassName("jw-icon-prev")[0];
			    element = copyReplaceElement(element);
			    element.addEventListener("click", prevClick);
			    element = document.getElementsByClassName("jw-icon-next")[0];
			    element = copyReplaceElement(element);
			    element.addEventListener("click", nextClick);
			}

			function prevClick(e) {
			    if (e.which == 1) {
			        OnPrevious();
			    }
			}

			function nextClick(e) {
			    if (e.which == 1) {
			        OnNext();
			    }
			}

			function OnPrevious() {
			    window.external.OnPrevious();
			}

			function OnNext() {
			    window.external.OnNext();
			}

			function copyReplaceElement(element) {
			    var old_element = element;
			    var new_element = old_element.cloneNode(true);
			    old_element.parentNode.replaceChild(new_element, old_element);
			    return new_element;
			}

			function registerWheelListeners() {
			    var elements = document.getElementsByClassName("jw-slider-time");
			    window.external.Log("jw-slider-time elements: " + elements.length);
			    if (elements.length == 1) {
			        for (var i = 0; i < elements.length; i++) {
			            elements[i].addEventListener("mousewheel", seekbar_scroll);
			        }
			    }

			    elements = document.getElementsByClassName("jw-video");
			    window.external.Log("jw-video elements: " + elements.length);
			    if (elements.length == 1) {
			        for (var i = 0; i < elements.length; i++) {
			            elements[i].addEventListener("mousewheel", volume_scroll);
			        }
			    }

			    elements = document.getElementsByClassName("jw-icon-volume");
			    window.external.Log("jw-icon-volume elements: " + elements.length);
			    if (elements.length == 2) {
			        for (var i = 0; i < elements.length; i++) {
			            elements[i].addEventListener("mousewheel", volume_scroll);
			        }
			    }
			}

			function volume_scroll(e) {
			    var up = e.wheelDelta > 0;

			    const VOL_STEP = 5;
			    var vol = GetVolume();
			    vol += up ? VOL_STEP : -VOL_STEP;
			    if (vol < 0) vol = 0;
			    if (vol > 100) vol = 100;
			    SetVolume(vol);
			}

			function seekbar_scroll(e) {
			    var up = e.wheelDelta > 0;

			    var duration = GetDuration();
			    const SCROLL_STEP = Math.ceil(duration / 150);
			    var currPos = GetPosition();

			    currPos += up ? SCROLL_STEP : -SCROLL_STEP;
			    SetPosition(currPos);

			    window.external.Log("got seekbar wheel event. Scrolled " + (up ? "up" : "down"));
			}

			function OnVolumeChange(event) {
			    window.external.OnVolumeChange(event.volume);
			}

			function OnMuteChange(event) {
			    window.external.OnMuteChange(event.mute);
			}

			function OnReady() {
			    setupNextPrev();
			    registerWheelListeners();
			    window.external.OnReady();
			}

			function IsPlaying() {
				return (playerInstance.getState() == "playing");
			}
			
			function GetPosition() {
			    return playerInstance.getPosition();
			}

			function SetPosition(position) {
			    return playerInstance.seek(position);
			}

			function Maximized() {
				return playerInstance.getFullscreen();
			}
			
			function Play() {
				playerInstance.play(true);
			}
			
			function Pause() {
				playerInstance.pause(true);
			}

			function SetMute(mute) {
			    playerInstance.setMute(mute);
			}

			function IsMuted() {
			    return playerInstance.getMute();
			}

			function SetVolume(volume) {
			    return playerInstance.setVolume(volume);
			}

			function GetVolume() {
			    return playerInstance.getVolume();
			}
			
			function PlayPause() {
				playerInstance.play();
			}

			function GetBuffer() {
			    return playerInstance.getBuffer();
			}

			function GetDuration() {
			    return playerInstance.getDuration();
			}
			
			function OnPlaylocationChanged(event) {
				if (!isOnReadyFired && playerInstance.getDuration() != 0) {
					isOnReadyFired = true;
					OnReady();
				}
				window.external.OnPlaylocationChanged(event.position * 1000, (event.duration - event.position) * 1000, event.duration * 1000);
			}
			
			function OnComplete(event) {
				window.external.OnPlaybackComplete();
			}
			
			function OnFullscreenChanged(event) {
				window.external.OnFullscreenChanged(event.fullscreen);
			}

			function OnError(event) {
			    window.external.OnError(event.message);
			}

			function OnSetupError(event) {
			    window.external.OnSetupError(event.message);
			}
			
			function ClickOnFullscreen() {
				elements = document.getElementsByClassName("jw-icon-fullscreen");
				for (i = 0; i < elements.length; i++) {
					var mousedown = document.createEvent("MouseEvent");
					mousedown.initMouseEvent('mousedown', true, false, window, {}, 0, 0, 0, 0, false, false, false, false, 0, elements[i]);
					var mouseup = document.createEvent("MouseEvent");
					mouseup.initMouseEvent('mouseup', true, false, window, {}, 0, 0, 0, 0, false, false, false, false, 0, elements[i]);
				    window.external.Log("Fireing mousedown event on: " + elements[i].outerHTML);
					elements[i].dispatchEvent(mousedown);
					window.external.Log("Fireing mouseup event on: " + elements[i].outerHTML);
					elements[i].dispatchEvent(mouseup);
				}
			}

			function Focus() {
			    window.external.Log("Focusing player!");
			    var element = document.getElementById('myvideo');
			    if (element != null) {
			        element.focus();
			    } else {
			        window.external.Log("Couldn't focus the div 'myvideo'!");
			    }
			}
		</script>
		
	</body>
</html>